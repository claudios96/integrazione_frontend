<!--
<script>
    window.onload = function() {
        var elmnt = document.getElementById("textarea1");
        elmnt.scrollIntoView({behavior: "auto", block: "start"});
    };
</script>
-->

<div>
    <div class="row">
        <div class="col-lg-12" align="center">
            <h1 ng-show="ctrl.type == 'prodotto'" class="page-header">Chat prodotto {{ctrl.id}}</h1>
            <h1 ng-show="ctrl.type == 'leader-member'" class="page-header">Chat leader-member ticket {{ctrl.id}}</h1>
            <h1 ng-show="ctrl.type == 'team'" class="page-header">Chat team {{ctrl.id}}</h1>
        </div>
        <!-- /.col-lg-12 -->

    </div>



    <ul>
        <table ng-repeat="message in ctrl.messages" width="100%" class="table_chat" id="table_chat_id" >
            <tr>

                <td>

                    <table ng-if="message.username == ctrl.userInfo.username" width="100%">
                        <tr>
                            <td class="colonna">{{message.completeName}}</td>
                        </tr>

                        <tr>
                            <td class="colonna">{{ message.timestamp | date:"MM/dd/yyyy 'ore' h:mma" }} </td>
                        </tr>

                        <tr>
                            <td ng-if="message.type == 'MESSAGE'" class="messaggio_out">
                                {{ message.text }}
                            </td>
                            <td ng-if="message.type == 'SNIPPET'" class="messaggio_out">
                                <button ng-if="message.type == 'SNIPPET'" type="submit" class="btn_snippet" ng-click="showDialogSnippetDetail(message.text)">Snippet</button>
                            </td>
                            <td ng-if="message.type == 'FILE'" class="messaggio_out">
                                <button ng-if="message.type == 'FILE'" type="submit" class="btn_snippet" ng-click="ctrl.getFile(ctrl.id, message.text)">{{ message.text }}</button>
                            </td>
                        </tr>

                        <tr><td height="20px"></td></tr>
                    </table>

                    <table ng-if="message.username != ctrl.userInfo.username" width="100%">

                        <tr>
                            <td>{{message.completeName}}</td>
                        </tr>

                        <tr>
                            <td>{{ message.timestamp | date:"MM/dd/yyyy 'ore' h:mma" }} </td>
                        </tr>

                        <!-- se messaggio di notifica , mostro bottone dettaglio ticket-->
                        <tr>
                            <td ng-if="message.type == 'MESSAGE' && message.username != 'System'" class="messaggio_in">
                                {{ message.text }}
                            </td>

                            <td ng-if="message.type == 'MESSAGE' && message.username == 'System'" class="messaggio_in">
                                {{message.text}} <button type="submit" class="btn_snippet" ng-click="ctrl.showTicketDetail(message.text)">Dettagli</button>

                            </td>

                            <td ng-if="message.type == 'SNIPPET'" class="messaggio_in">
                                <button ng-if="message.type == 'SNIPPET'" type="submit" class="btn_snippet" ng-click="showDialogSnippetDetail(message.text)">Snippet</button>
                            </td>
                            <td ng-if="message.type == 'FILE'" class="messaggio_in">
                                <button ng-if="message.type == 'FILE'" type="submit" class="btn_snippet" ng-click="ctrl.getFile(ctrl.id, message.text)">{{ message.text }}</button>
                            </td>
                        </tr>
                        <tr><td height="20px"></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </ul>


    <div class="col-lg-12" align="center" ng-controller="ChatCtrl" style="padding-bottom: 10%">
        <form>
            <textarea id="textarea1" ng-model="ctrl.messageContent" type="text" class="textarea_chat" placeholder="Scrivi un messaggio..." autofocus></textarea>

            <button type="submit" class="btn btn-primary" ng-click="ctrl.sendMessage()" style="margin-top: 0.6%">Invia</button>

            <button ng-click="showDialogInsertSnippet()" class="btn btn-primary btn-chat">Invia Snippet</button>

            <input id="file_button" type="file" custom-on-change="selectedFile"/>
            <!--<button  class="btn btn-primary btn-lg btn-block" ng-click="ctrl.uploadFile()">Upload</button>-->

        </form>
    </div>
</div>
